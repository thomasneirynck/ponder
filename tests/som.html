<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="../bower_components/requirejs/require.js"></script>
    <style>
        html, body {
            margin: 0 auto;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>


<canvas id="som" style="width: 100%; height: 100%; overflow: hidden"></canvas>


<script>

    require({
                baseUrl: "..",
                paths: {
                    'ponder': 'src',
                    'type': "bower_components/type/type",
                    'Promise': "bower_components/Promise/Promise"
                }
            },
            ["ponder/SOM"], function (SOM) {

                var width = 32;
                var height = 32;
                var som = new SOM({
                    width: width,
                    height: height,
                    codeBookSize: 3
                });

                var data = [
                    1, 0, 0,
                    0, 1, 0,
                    0, 0, 1,
                    0, 1, 1,
                    1, 0, 1,
                    1, 1, 0,
                    1, 1, 1,
                    0, 0.2, 0.7,
                    0.2, 0.7, 0.1,
                    0, 0.8, 0,
                    0.9, 0.3, 0
                ];


                var context2d = document.getElementById("som").getContext("2d");
                context2d.canvas.width = document.body.clientWidth;
                context2d.canvas.height = document.body.clientHeight;

                var buffer = document.createElement("canvas").getContext("2d");
                buffer.canvas.width = width;
                buffer.canvas.height = height;

                var bufferImageData = buffer.getImageData(0, 0, buffer.canvas.width, buffer.canvas.height);

                function fillPixel(weights, wi, pixel, pixeli) {
                    pixel[pixeli] = Math.round(weights[wi] * 255);
                    pixel[pixeli + 1] = Math.round(weights[wi + 1] * 255);
                    pixel[pixeli + 2] = Math.round(weights[wi + 2] * 255);
                    pixel[pixeli + 3] = 255;
                }

                function done() {

                    var out = {};
                    for (var i = 0; i < data.length; i += 3) {
                        som.bmu(data, i, out);

                        context2d.fillStyle = "rgb(" +Math.round(data[i] * 255) + "," + Math.round(data[i + 1] * 255) + "," + Math.round(data[i + 2] * 255) + ")";

                        context2d.fillRect(out.x * context2d.canvas.width / width, out.y * context2d.canvas.height / height, 10, 10);

                        context2d.strokeStyle = "rgb(0,0,0)";
                        context2d.lineWidth = 3;
                        context2d.strokeRect(out.x * context2d.canvas.width / width, out.y * context2d.canvas.height / height, 10, 10);
                        context2d.strokeStyle = "rgb(255,255,255)";
                        context2d.lineWidth = 2;
                        context2d.strokeRect(out.x * context2d.canvas.width / width, out.y * context2d.canvas.height / height, 10, 10);
                    }

                }

                function progress() {
                    som.fill2dImageData(bufferImageData, fillPixel);
                    buffer.putImageData(bufferImageData, 0, 0);
                    context2d.drawImage(buffer.canvas, 0, 0, context2d.canvas.width, context2d.canvas.height);
                }

                som.trainMap(data);
                progress();
                done();


            });


</script>


</body>
</html>